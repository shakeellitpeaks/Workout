<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/css/style.css?jsfdj">
    <title>Workout app</title>
</head>
<body>
    <main class="wrapper" id="app">
        <div class="form_section">
            <h2 class="section_title">{{ workout }} <a href="workout-2.html" class="next_workout">Next</a></h2>
            
            <div class="workout_schedule_section">
                <div class="column">
                    <div class="flex_section">
                        <h5>Workout Time</h5>
                        <img src="assets/images/clock-icon.png" alt="clock-icon">
                    </div>
                    <div class="time_section">
                        <h2>{{ countdown }}</h2>
                    </div>
                    <p>(Starts at 00:00 and counts up to {{workoutTime}})</p>
                </div>
                <div class="column">
                    <div class="flex_section">
                        <h5>Workout Plan</h5>
                        <img src="assets/images/checklist-icon.png" alt="checklist-icon">
                    </div>

                    <div class="time_section" v-for="(stage, index) in workoutStages" :key="index">
                        <h5 :class="{ 'highlighted': currentStageIndex === index }">{{ stage.name }} - {{ stage.subName }}</h5>
                            <img v-if="currentStageIndex === index" src="assets/images/checkmark.png" alt="checkmark" class="checkmark">
                    </div>
                    <p>(Starts at 00:00 and counts up to {{workoutTime}})</p>
                </div>
            </div>

            <div class="count_wrapper">
                <div class="count_child_section">
                    <h2>{{ remainingTime }}</h2>
                    <p>{{ currentWorkoutStage.subName }}</p>
                </div>
                <div class="count_child_section">
                    <h2>{{ currentWorkoutStage.name }}</h2>
                    <p>Action</p>
                </div>
                <div class="count_child_section">
                    <h2>{{ currentWorkoutStage.oLevel }}</h2>
                    <p>O2 Setting</p>
                </div>
            </div>
            

            <div class="calculations_container">
                <div class="column">
                    <div>
                        <img src="assets/images/love-icon.png" alt="love-icon">
                    </div>
                    <div>
                        <h2>125</h2>
                        <p>BPM</p>
                    </div>
                </div>
                <div class="column">
                    <div>
                        <img src="assets/images/temprature-icon.png" alt="temprature-icon">
                    </div>
                    <div>
                        <h2>96%</h2>
                        <p>O2%</p>
                    </div>
                </div>
            </div>
            <button class="next_btn" @click="toggleTimer">{{timerRunning ? 'Pause' : 'Start'}}</button>      
        </div>
    </main>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script>
        const app = Vue.createApp({
            data() {
                return {
                    workout: "Workout plan  #1",
                    countdown: "10:00",
                    workoutTime: "10:00",
                    timer: null,
                    timerRunning: false,
                    savedTime: null,
                    workoutStages: [
                        { name: "Recovery", subName: '2 Mins', duration: 120, oLevel: 'High O2'},
                        { name: "Sprint", subName: '1 Min', duration: 60, oLevel: 'Low O2' },
                        { name: "Recovery", subName: '1 Min', duration: 60, oLevel: 'High O2'},
                        { name: "Sprint", subName: '1 Min', duration: 60, oLevel: 'Low O2' },
                        { name: "Recovery", subName: '1 Min', duration: 60, oLevel: 'High O2' },
                        { name: "Sprint", subName: '1 Min', duration: 60, oLevel: 'Low O2' },
                        { name: "Recovery", subName: '3 Mins', duration: 180, oLevel: 'High O2' }
                    ],
                    currentStageIndex: 0,
                    currentStageTime: 0
                };
            },
            methods: {
                toggleTimer() {
                    if (!this.timerRunning) {
                        this.startTimer();
                    } else {
                        this.pauseTimer();
                    }
                },
                startTimer() {
                    this.timerRunning = true;
    
                    this.timer = setInterval(() => {
                        const timeParts = this.countdown.split(":");
                        let minutes = parseInt(timeParts[0], 10);
                        let seconds = parseInt(timeParts[1], 10);
    
                        if (minutes === 0 && seconds === 0) {
                            clearInterval(this.timer);
                            this.timerRunning = false;
                            return;
                        }
    
                        if (seconds === 0) {
                            minutes--;
                            seconds = 59;
                        } else {
                            seconds--;
                        }
    
                        const formattedMinutes = String(minutes).padStart(2, "0");
                        const formattedSeconds = String(seconds).padStart(2, "0");
    
                        this.countdown = `${formattedMinutes}:${formattedSeconds}`;
                        this.updateCurrentStageTime();
                    }, 1000);
                },
                pauseTimer() {
                    clearInterval(this.timer);
                    this.timerRunning = false;
                    this.savedTime = this.countdown;
                },
                resetTimer() {
                    clearInterval(this.timer);
                    this.timerRunning = false;
                    this.countdown = "10:00";
                    this.savedTime = null;
                    this.currentStageIndex = 0;
                    this.currentStageTime = 0;
                },
                updateCurrentStageTime() {
                    this.currentStageTime++;
                    const currentStage = this.workoutStages[this.currentStageIndex];
                    if (this.currentStageTime >= currentStage.duration) {
                        if (this.currentStageIndex < this.workoutStages.length - 1) {
                            this.currentStageIndex++;
                        } else {
                            clearInterval(this.timer);
                            this.timerRunning = false;
                            return;
                        }
                        this.currentStageTime = 0;
                    }
                },
                getRemainingTime(stage) {
                    if (this.currentStageIndex === this.workoutStages.indexOf(stage)) {
                        const remainingSeconds = stage.duration - this.currentStageTime;
                        const minutes = Math.floor(remainingSeconds / 60);
                        const seconds = remainingSeconds % 60;
                        return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                    }
                    return ''; // Display nothing if the stage is not current
                }
            },
            computed: {
                currentWorkoutStage() {
                    return this.workoutStages[this.currentStageIndex];
                },
                remainingTime() {
                    const currentStage = this.workoutStages[this.currentStageIndex];
                    const remainingSeconds = currentStage.duration - this.currentStageTime;
                    const minutes = Math.floor(remainingSeconds / 60);
                    const seconds = remainingSeconds % 60;
                    return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }
            },

            mounted() {
                if (this.savedTime) {
                    this.countdown = this.savedTime;
                    this.startTimer();
                }
            }
        });
    
        app.mount("#app");
    </script>
    

</body>
</html>
